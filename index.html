<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <link rel="icon" type="image/png" href="/images/icons-48.png"/>
        <link rel="manifest" href="manifest.webmanifest">
        <script async src="/js/libs/pwacompat.min.js"></script>
        <script>
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => {
                        console.log('votre service worker a été enregistré !');
                    }).catch(error => {
                        console.error(error);
                    });
            } else {
                console.log('Ce navigateur ne suporte pas cette API');
            }

        </script>
        <title> Guzi Payment </title>
        <link href="/css/bootstrap.min.css" rel="stylesheet" />
        <link href="/css/guzi.css" rel="stylesheet" />
        <script src="./js/core/guzi.js"></script>
        <script src="./js/libs/jquery.min.js"></script>
        <script src="./js/libs/bootstrap.min.js"></script>
        <script src="./js/libs/localforage.min.js"></script>
        <script src="./js/libs/msgpack.min.js"></script>
        <script src="./js/libs/elliptic.min.js"></script>
        <script src="./js/libs/sha.min.js"></script>
        <script src="./js/libs/crypto-js/core.js"></script>
        <script src="./js/libs/crypto-js/x64-core.js"></script>
        <script src="./js/libs/crypto-js/lib-typedarrays.js"></script>
        <script src="./js/libs/crypto-js/enc-utf16.js"></script>
        <script src="./js/libs/crypto-js/enc-base64.js"></script>
        <script src="./js/libs/crypto-js/enc-base64url.js"></script>
        <script src="./js/libs/crypto-js/md5.js"></script>
        <script src="./js/libs/crypto-js/sha1.js"></script>
        <script src="./js/libs/crypto-js/sha256.js"></script>
        <script src="./js/libs/crypto-js/sha224.js"></script>
        <script src="./js/libs/crypto-js/sha512.js"></script>
        <script src="./js/libs/crypto-js/sha384.js"></script>
        <script src="./js/libs/crypto-js/sha3.js"></script>
        <script src="./js/libs/crypto-js/ripemd160.js"></script>
        <script src="./js/libs/crypto-js/hmac.js"></script>
        <script src="./js/libs/crypto-js/pbkdf2.js"></script>
        <script src="./js/libs/crypto-js/evpkdf.js"></script>
        <script src="./js/libs/crypto-js/cipher-core.js"></script>
        <script src="./js/libs/crypto-js/mode-cfb.js"></script>
        <script src="./js/libs/crypto-js/mode-ctr.js"></script>
        <script src="./js/libs/crypto-js/mode-ctr-gladman.js"></script>
        <script src="./js/libs/crypto-js/mode-ofb.js"></script>
        <script src="./js/libs/crypto-js/mode-ecb.js"></script>
        <script src="./js/libs/crypto-js/pad-ansix923.js"></script>
        <script src="./js/libs/crypto-js/pad-iso10126.js"></script>
        <script src="./js/libs/crypto-js/pad-iso97971.js"></script>
        <script src="./js/libs/crypto-js/pad-zeropadding.js"></script>
        <script src="./js/libs/crypto-js/pad-nopadding.js"></script>
        <script src="./js/libs/crypto-js/format-hex.js"></script>
        <script src="./js/libs/crypto-js/aes.js"></script>
        <script src="./js/libs/crypto-js/tripledes.js"></script>
        <script src="./js/libs/crypto-js/rc4.js"></script>
        <script src="./js/libs/crypto-js/rabbit.js"></script>
        <script src="./js/libs/crypto-js/rabbit-legacy.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", (event) => {
                setBindings();
                updateContacts();
                updatePage();
            });
        </script>
    </head>
    <body>
        <div id="landing-first-visit" class="container basically-hidden">
            <div class="position-relative overflow-hidden p-3 p-md-5 m-md-3 text-center bg-light">
                <div class="col-md-5 p-lg-5 mx-auto my-5">
                    <h1 class="display-4 font-weight-normal">Le Guzi</h1>
                    <p class="lead font-weight-bold">L'économie du nouveau monde. </p>
                    <p class="lead font-weight-normal">L'alternative économique éthique : bonne pour la planète et pour les humains.</p>
                    <a id="newAccountButton" class="btn btn-outline-secondary" href="#" data-bs-toggle="modal" data-bs-target="#newAccountModal">Créer mon compte</a>
                </div>
                <div class="product-device shadow-sm d-none d-md-block"></div>
                <div class="product-device product-device-2 shadow-sm d-none d-md-block"></div>
            </div>
            <br>
            <div class="row">
                <div class="col-md-4">
                    <h2>Décentralisée</h2>
                    <p>Il n'y a pas d'entité qui créé les <em>Guzis</em>. Au contraire, <strong>chacun créé ses propres <em>Guzis</em></strong> chaque jour. Mais ils ne sont pas créés au hasard : quand vous créez votre compte vous créez 1 Guzi/jour. Puis, à force de recevoir des <em>Guzis</em>, vous en créerez de plus en plus quotidiennement.</p>
                    <p>Votre <em>Total</em> est le nombre de <em>Guzis</em> reçus depuis la création de votre compte. C'est sa valeur qui détermine le nombre de <em>Guzis</em> que vous créez par jour.</p>
                </div>
                <div class="col-md-4">
                    <h2>À usage unique</h2>
                    <p>Chaque Guzi est à usage unique. Quand vous recevez des <em>Guzis</em> comme paiement, ils ne vont pas dans votre porte monnaie mais viennent à la place augmenter votre <em>Total</em>. </p>
                    <p>Plus votre <em>Total</em> est grand, plus vous créez de <em>Guzis</em> par jour.</p>
                    <p><strong>Vous ne pouvez en fait dépenser que vos propres Guzis</strong>, ceux que vous créez.</p>
                </div>
                <div class="col-md-4">
                    <h2>Périssable</h2>
                    <p>Chaque <em>Guzi</em> que vous créez a <strong>une durée de vie de 30 jours</strong>.</p>
                    <p>Néanmoins, vous pouvez dépenser vos propres <em>Guzis</em> non dépensés envers vous-même pour augmenter votre <em>Total</em>. Ainsi, <strong>même si certains de vos <em>Guzis</em> arrivent à peremption, ils ne sont pas perdus.</strong></p>
                    <p><a class="btn btn-secondary" href="https://www.guzi.fr/2021/06/decouvrir-le-guzi.html" target="_blank" role="button">En savoir plus »</a></p>
                </div>
            </div>
        </div>

        <div id="landing-created-account" class="container basically-hidden">
            <div class="position-relative overflow-hidden p-3 p-md-5 m-md-3 text-center bg-light">
                <div class="col-md-5 p-lg-5 mx-auto my-5">
                    <h1 class="display-4 font-weight-normal">Bravo !</h1>
                    <p class="lead font-weight-bold">Votre compte est créé</p>
                    <p class="lead font-weight-normal">Il vous faut maintenant un référent pour le valider</p>
                    <a id="sendAccountButton" class="btn btn-outline-secondary" href="#">Envoyer mon compte pour validation</a>
                    <a id="importValidatedAccountButton" class="btn btn-outline-secondary" href="#">Importer mon compte validé</a>
                </div>
                <div class="product-device shadow-sm d-none d-md-block"></div>
                <div class="product-device product-device-2 shadow-sm d-none d-md-block"></div>
            </div>
            <br>
            <div class="row">
                <div class="col">
                    <h2>Pourquoi ai-je besoin d'un référent ?</h2>
                    <p>Le Guzi est décentralisé. Entièrement. Il n'y a pas de réseau de mineurs comme en Bitcoin ou de banques. À la place, nous utilisons un réseau de référent locaux.</p>
                    <p>Par exemple, si vous souhaitez utiliser le Guzi dans votre ville, il vous faut un référent, qui peut être une entité officielle (mairie, association) ou une personne volontaire (vous, par exemple).</p>
                    <p>Ce référent va vérifier, pour chaque personne qui s'inscrit, que cette personne est réelle et que sa date de naissance est valide. Puis le référent va se porter garant de cette personne.</p>
                    <p>Ensuite, chacun sait qu'il peut faire confiance au paiement d'un inconnu tant que celui-ci a un référent fiable.</p>

                    <h2>Comment faire ?</h2>
                    <p>1/ Dans un premier temps, cliquez sur "Envoyer mon compte pour validation" puis envoyez le code qui apparait dans la fenêtre soit par email, soit par un autre moyen.</p>
                    <p>2/ Le référent, de son côté, va pouvoir signer votre demande, pour s'en porter garant. Puis il vous enverra votre demande signée (un autre grand code). Vous devrez alors cliquer sur "Importer mon compte validé" et y coller le code reçu.</p>
                    <p>3/ Et ensuite, vous serez Niveau 1 et pourrez créer vos premier Guzis.</p>
                </div>
            </div>
        </div>

        <div id="landing-validated-account" class="container basically-hidden">
            <nav class="navbar navbar-dark bg-dark">
                <a class="navbar-brand" href="#">Gus</a>
                <a id="navbarToggleBtn" class="navbar-toggler" type="button" data-bs-toggle="collapse" href="#navbarToggler" aria-controls="navbarToggler" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </a>

                <div class="collapse navbar-collapse" id="navbarToggler">
                    <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
                        <li class="nav-item">
                            <a id="home-tab" class="nav-link" href="#home">Accueil <span class="sr-only">(current)</span></a>
                        </li>
                        <li class="nav-item">
                            <a id="contacts-tab" class="nav-link" href="#contacts">Contacts</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <div class="progress w-100" style="height: 30px;">
                <div id="levelProgressBar" class="progress-bar bg-info" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">Niveau 0</div>
            </div>

            <p></p>

            <div id="home" class="container tab-panel">
                <div class="row">
                    <div class="col-6 p-1">
                        <button class="btn btn-primary w-100" disabled>
                            <p id="guziAvailableAmount" class="text-center vertical-align">
                            Guzis disponibles 0/0
                            </p>
                        </button>
                    </div>
                    <div class="col-6 p-1">
                        <button id="createMyGuzisButton" class="btn btn-secondary w-100">
                            <p class="text-center vertical-align">Créer mes Guzis</p>
                        </button>
                    </div>
                    <div class="col-6 p-1">
                        <button id="importPaymentButton" class="btn btn-warning w-100">
                            <p class="text-center vertical-align">Encaisser</p>
                        </button>
                    </div>
                    <div class="col-6 p-1">
                        <button id="paymentButton" class="btn btn-danger w-100">
                            <p class="text-center vertical-align">Payer</p>
                        </button>
                    </div>
                    <div class="col-6 p-1">
                        <button id="be-referent-button" class="btn btn-success w-100">
                            <p class="text-center vertical-align">Être référent</p>
                        </button>
                    </div>
                    <div class="col-6 p-1">
                        <button id="share-my-key-button" class="btn btn-info w-100">
                            <p class="text-center vertical-align">Partager ma clé</p>
                        </button>
                    </div>
                </div>
            </div>
            <div id="contacts" class="tab-panel">
                <div class="row">
                    <div class="col">
                        <h2> Contacts </h2>
                    </div>
                    <div class="col-12 col-md-auto">
                        <div class="btn-group-vertical">
                            <button id="newContactButton" class="btn btn-secondary" type="button" data-bs-toggle="modal" data-bs-target="#newContactModal">
                                Nouveau contact
                            </button>
                        </div>
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="col">
                        <table class="table-responsive">
                            <thead>
                                <tr>
                                    <th scope="col">Nom</th>
                                    <th scope="col">Email</th>
                                    <th scope="col">Payer</th>
                                </tr>
                            </thead>
                            <tbody id="contact-list">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal for contact creation/edition -->
        <div class="modal fade" id="newContactModal" tabindex="-1" aria-labelledby="newContactModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form>
                        <div class="modal-header">
                            <h5 class="modal-title" id="newContactModalLabel">Nouveau contact</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <label for="new-contact-modal-name" class="form-label">Nom</label>
                                <input type="text" class="form-control" id="new-contact-modal-name">
                            </div>
                            <div class="mb-3">
                                <label for="new-contact-modal-email" class="form-label">Adresse email</label>
                                <input type="email" class="form-control" id="new-contact-modal-email" aria-describedby="emailHelp">
                                <div id="emailHelp" class="form-text">Tout les informations restent sur votre téléphone, il n'y a aucun serveur.</div>
                            </div>
                            <div class="mb-3">
                                <label for="new-contact-modal-key" class="form-label">Clé publique</label>
                                <textarea class="form-control" id="new-contact-modal-key" rows="3"></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                            <button id="newContactValidationButton" type="submit" class="btn btn-primary" data-bs-dismiss="modal"> Enregistrer</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Modal for account creation -->
        <div class="modal fade" id="newAccountModal" tabindex="-1" aria-labelledby="newAccountModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form>
                        <div class="modal-header">
                            <h5 class="modal-title" id="newAccountModalLabel">Create account</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <label for="new-account-modal-birthdate" class="form-label">Birthdate</label>
                                <input type="text" class="form-control" id="new-account-modal-birthdate" placeholder="DD/MM/YYYY" required>
                                <div id="birthdateHelp" class="form-text">Data you enter here will only be stored on your phone, there is no server.</div>
                            </div>
                            <div class="mb-3">
                                <label for="new-account-modal-password" class="form-label">Password</label>
                                <input type="password" class="form-control" id="new-account-modal-password" required>
                            </div>
                            <div class="mb-3">
                                <label for="new-account-modal-password-confirmation" class="form-label">Confirm Password</label>
                                <input type="password" class="form-control" id="new-account-modal-password-confirmation" required>
                                <div id="pwd-error" class="alert alert-warning invisible" role="alert">
                                    Password and confirmation must be the same
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                            <button id="newAccountValidationButton" type="submit" class="btn btn-primary" > Enregistrer</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Modal for any data import -->
        <div class="modal fade" id="importModal" tabindex="-1" aria-labelledby="importModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="importModalLabel"> Importer</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="mb-3">
                                <label for="import-data-pasted" class="form-label">Coller ici le contenu du message</label>
                                <textarea class="form-control" id="import-data-pasted" rows="5"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"> Annuler</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal for any data export -->
        <div class="modal fade" id="exportModal" tabindex="-1" aria-labelledby="exportModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form>
                        <div class="modal-header">
                            <h5 class="modal-title" id="exportModalLabel"> Envoyer</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <label for="export-data-content" class="form-label">Contenu à envoyer</label>
                                <textarea class="form-control" id="export-data-content" rows="5"></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"> Annuler</button>
                            <button id="exportModalCopyButton" type="button" class="btn btn-secondary" data-bs-dismiss="modal"> Copier</button>
                            <button id="exportModalEmailButton" type="submit" class="btn btn-secondary" data-bs-dismiss="modal"> Envoyer par mail</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Modal for account validation -->
        <div class="modal fade" id="accountValidationModal" tabindex="-1" aria-labelledby="accountValidationModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="accountValidationModalLabel"> Devenir référent</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <table class="table table-striped overflow-auto">
                            <thead>
                                <tr>
                                    <th scope="col">Champs</th>
                                    <th scope="col">Valeur</th>
                                </tr>
                            </thead>
                            <tbody id="account-validation-detail">
                            </tbody>
                        </table>
                        <div id="account-validation-state"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"> Annuler</button>
                        
                        <button id="accountValidationButton" type="button" class="btn btn-success">
                            Se porter garant du compte
                        </button>

                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal for password prompt -->
        <div class="modal fade" id="pwdModal" tabindex="-1" aria-labelledby="pwdModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                        <form>
                    <div class="modal-header">
                        <h5 class="modal-title" id="newContactModalLabel"> Mot de passe</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                            <div class="mb-3">
                                <input type="password" class="form-control" id="pwdPrompt" placeholder="Mot de passe">
                            </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"> Annuler</button>
                        <button id="pwdValidation" type="submit" class="btn btn-success">
                            Valider
                        </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal for any error -->
        <div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="newContactModalLabel"> Erreur</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <div id="modal-error-content" class="alert alert-danger" role="alert">
                                An error occured
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"> Fermer</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal for payment -->
        <div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form>
                        <div class="modal-header">
                            <h5 class="modal-title" id="paymentModalLabel">Paiement</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <label for="pay-modal-target" class="form-label">Qui paye-t-on ?</label>
                                <select class="form-control" id="pay-modal-target">
                                    <option>1</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="pay-modal-amount" class="form-label">Combien ?</label>
                                <input type="range" class="form-control-range" min="0" max="10" id="pay-modal-amount" onInput="$('#pay-modal-amount-display').html($(this).val())">
                                <span id="pay-modal-amount-display">0</span>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                            <button id="paymentValidationButton" type="submit" class="btn btn-primary" data-bs-dismiss="modal"> Envoyer Paiement</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </body>
</html>
